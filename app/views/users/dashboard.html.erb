<h1 class="text-center">MON DASHBOARD</h1>

<h2>Mon profil</h2>
<div class="profil">
  <div>
    <% if current_user.photo.file.nil? %>
      <p>Ajoutez votre trombine :</p>
    <% else %>
      <%= cl_image_tag(current_user.photo, {class: "avatar-large"}) %>
    <% end %>
  </div>

  <div class="profil-infos">
    <p><%= current_user.fullname %></p>
    <p><%= link_to 'Editer le profil',  edit_user_registration_path %></p>
  </div>
</div>

<h2>Mes parents</h2>

<% if current_user.couple.nil? %>
  <%= link_to 'Mettre mes parents √† louer', new_couple_path %>
<% else %>
  <%= cl_image_tag(current_user.couple.photo, {class: "avatar-big"}) %>
  <p>Les <%= current_user.couple.name %> üòä</p>

  <% unless current_user.couple.bookings.first.nil?  %>
    <p>Leurs r√©servations :</p>
    <% current_user.couple.bookings.each do |booking| %>
      <hr>
      <p>R√©serv√©s par <%= booking.user.fullname %> pour le <%= booking.start_date %></p>
      <%= simple_form_for [current_user.couple, booking] do |f| %>
        <%= f.error_notification %>
        <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>
        <div class="form-inputs">
          <%= f.input :status, :collection => Booking::STATUS %>
        </div>
        <div class="form-inputs">
          <%= f.submit %>
        </div>
      <% end %>
      <hr>
    <% end %>
  <% end %>
<% end %>

<h2>My reservations</h2>

<div class="booking-card">
  <h3>Upcoming reservations</h3>
  <% @upcoming_bookings.each do |upcoming_booking| %>
    <%= upcoming_booking.couple.name %>
    <p> Du <%= upcoming_booking.start_date %> au <%= upcoming_booking.end_date %></p>
  <% end %>
</div>

<div class="booking-card">
  <h3>Previous reservations to review</h3>

  <% @old_bookings_to_review.each do |old_booking_to_review| %>

    <p>Vous avez r√©serv√© avec <%= old_booking_to_review.couple.name %></p>
    <p>Du <%= old_booking_to_review.start_date %> au <%= old_booking_to_review.end_date %></p>

    <p>Reviewez ces parents:</p>
    <%= simple_form_for [old_booking_to_review.couple, old_booking_to_review] do |f| %>
    <%= f.error_notification %>
    <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>
        <div class="form-inputs">
          <%= f.input :review_content %>
        </div>
        <div class="form-inputs">
          <%= f.submit %>
        </div>
      <% end %>
    <% end %>
</div>

<div class="booking-card">
  <h3>Previous reservations</h3>

  <% @reviewed_old_bookings.each do |reviewed_old_booking| %>

    <p>Vous avez r√©serv√© avec <%= reviewed_old_booking.couple.name %></p>
    <p>Du <%= reviewed_old_booking.start_date %> au <%= reviewed_old_booking.end_date %></p>
    <p>Votre review: </p> <br>
    <p><%= reviewed_old_booking.review_content %></p>

  <% end %>


</div>
